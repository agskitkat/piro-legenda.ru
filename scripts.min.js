// include where
"use strict";
$().ready(function() {
    var debug = true;
    var cart = [];
    $('.good_quantity_block .increment').click(function() {
        var quantity = $(this).parent().find("input").val();
        quantity++;
        $(this).parent().find("input").val(quantity);
        if(quantity > 1) {
            $(this).parent().find(".decrement").removeClass('disabled');
        }
    });
    $('.good_quantity_block .decrement').click(function() {
        var quantity = $(this).parent().find("input").val();
        console.log(quantity);
        quantity--;
        if( !$(this).hasClass('disabled')) {
            $(this).parent().find("input").val(quantity);
            if (quantity === 1) {
                $(this).addClass('disabled');
            }
        }
    });

    $('.add_to_cart_block .add_button').click(function() {
        var ID = $(this).attr("data-product-id");
        if(ID) {
            var quantity = $(this).parent().find("input").val();
            var good_id = $(this).parent().find("input").attr('good_id');
            drop_to_cart(ID, quantity);
        } else {
            //TODO ID error
            alert("AJAX: нет ID");
            drop_to_cart(1, 1);
        }
    });
    //TODO Отправить товар, получить сумму и количество позиций
    var items_cart = 0;
    var sum_cart_price = 0;
    function drop_to_cart(good, quantity) {
        // AJAX Function here
        let jsonData = JSON.stringify({"quantity":quantity, "id":good});
        $.post( "/local/ajax/add2basket.php", jsonData,  function( data ) {
            // New data in header-cart set
            items_cart = data.quantity;
            sum_cart_price = data.price;
            $(".cart-block-header .items-count").html(items_cart+ "<span class=\"items-name\">"+declOfNum(+items_cart, ["товар","товара","товаров"])+"</span>");
            $(".cart-block-header .cart-sum").html("<div class=\"cart-sum\">"+sum_cart_price+" руб.</div>");
            console.log(data);
        });
    }
});

/*!
 * in-view 0.6.1 - Get notified when a DOM element enters or exits the viewport.
 * Copyright (c) 2016 Cam Wiegert <cam@camwiegert.com> - https://camwiegert.github.io/in-view
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.inView=e():t.inView=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(2),o=r(i);t.exports=o["default"]},function(t,e){function n(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(9),o=r(i),u=n(3),f=r(u),s=n(4),c=function(){if("undefined"!=typeof window){var t=100,e=["scroll","resize","load"],n={history:[]},r={offset:{},threshold:0,test:s.inViewport},i=(0,o["default"])(function(){n.history.forEach(function(t){n[t].check()})},t);e.forEach(function(t){return addEventListener(t,i)}),window.MutationObserver&&addEventListener("DOMContentLoaded",function(){new MutationObserver(i).observe(document.body,{attributes:!0,childList:!0,subtree:!0})});var u=function(t){if("string"==typeof t){var e=[].slice.call(document.querySelectorAll(t));return n.history.indexOf(t)>-1?n[t].elements=e:(n[t]=(0,f["default"])(e,r),n.history.push(t)),n[t]}};return u.offset=function(t){if(void 0===t)return r.offset;var e=function(t){return"number"==typeof t};return["top","right","bottom","left"].forEach(e(t)?function(e){return r.offset[e]=t}:function(n){return e(t[n])?r.offset[n]=t[n]:null}),r.offset},u.threshold=function(t){return"number"==typeof t&&t>=0&&t<=1?r.threshold=t:r.threshold},u.test=function(t){return"function"==typeof t?r.test=t:r.test},u.is=function(t){return r.test(t,r)},u.offset(0),u}};e["default"]=c()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,r){n(this,t),this.options=r,this.elements=e,this.current=[],this.handlers={enter:[],exit:[]},this.singles={enter:[],exit:[]}}return r(t,[{key:"check",value:function(){var t=this;return this.elements.forEach(function(e){var n=t.options.test(e,t.options),r=t.current.indexOf(e),i=r>-1,o=n&&!i,u=!n&&i;o&&(t.current.push(e),t.emit("enter",e)),u&&(t.current.splice(r,1),t.emit("exit",e))}),this}},{key:"on",value:function(t,e){return this.handlers[t].push(e),this}},{key:"once",value:function(t,e){return this.singles[t].unshift(e),this}},{key:"emit",value:function(t,e){for(;this.singles[t].length;)this.singles[t].pop()(e);for(var n=this.handlers[t].length;--n>-1;)this.handlers[t][n](e);return this}}]),t}();e["default"]=function(t,e){return new i(t,e)}},function(t,e){"use strict";function n(t,e){var n=t.getBoundingClientRect(),r=n.top,i=n.right,o=n.bottom,u=n.left,f=n.width,s=n.height,c={t:o,r:window.innerWidth-u,b:window.innerHeight-r,l:i},a={x:e.threshold*f,y:e.threshold*s};return c.t>e.offset.top+a.y&&c.r>e.offset.right+a.x&&c.b>e.offset.bottom+a.y&&c.l>e.offset.left+a.x}Object.defineProperty(e,"__esModule",{value:!0}),e.inViewport=n},function(t,e){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(e,function(){return this}())},function(t,e,n){var r=n(5),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},function(t,e,n){function r(t,e,n){function r(e){var n=x,r=m;return x=m=void 0,E=e,w=t.apply(r,n)}function a(t){return E=t,j=setTimeout(h,e),M?r(t):w}function l(t){var n=t-O,r=t-E,i=e-n;return _?c(i,g-r):i}function d(t){var n=t-O,r=t-E;return void 0===O||n>=e||n<0||_&&r>=g}function h(){var t=o();return d(t)?p(t):void(j=setTimeout(h,l(t)))}function p(t){return j=void 0,T&&x?r(t):(x=m=void 0,w)}function v(){void 0!==j&&clearTimeout(j),E=0,x=O=m=j=void 0}function y(){return void 0===j?w:p(o())}function b(){var t=o(),n=d(t);if(x=arguments,m=this,O=t,n){if(void 0===j)return a(O);if(_)return j=setTimeout(h,e),r(O)}return void 0===j&&(j=setTimeout(h,e)),w}var x,m,g,w,j,O,E=0,M=!1,_=!1,T=!0;if("function"!=typeof t)throw new TypeError(f);return e=u(e)||0,i(n)&&(M=!!n.leading,_="maxWait"in n,g=_?s(u(n.maxWait)||0,e):g,T="trailing"in n?!!n.trailing:T),b.cancel=v,b.flush=y,b}var i=n(1),o=n(8),u=n(10),f="Expected a function",s=Math.max,c=Math.min;t.exports=r},function(t,e,n){var r=n(6),i=function(){return r.Date.now()};t.exports=i},function(t,e,n){function r(t,e,n){var r=!0,f=!0;if("function"!=typeof t)throw new TypeError(u);return o(n)&&(r="leading"in n?!!n.leading:r,f="trailing"in n?!!n.trailing:f),i(t,e,{leading:r,maxWait:e,trailing:f})}var i=n(7),o=n(1),u="Expected a function";t.exports=r},function(t,e){function n(t){return t}t.exports=n}])});
// Login page /start
"use strict";
$().ready(function() {
    function fragment(fragmentClass) {
        $(".fragments .active").removeClass("active");
        $("."+fragmentClass).addClass("active");
        centerdAlternative();
    }
    $(".fragmentChanger").click(function() {
        var fragmentClass = $(this).attr("data");
        console.log(fragmentClass);
        fragment(fragmentClass);
    });
    function centerdAlternative() {
        var e = $(".fragments .active .alternative");
        var ww = $(".fragments .active").width();
        var w = e.width();
        $(".alternative").css({"margin-left": (ww - w) / 2  + "px"});
        console.log({
            window:ww,
            w:w,
            result: ww-w
        });
    }
    centerdAlternative();
});
// Login page /stop
// INCLUDE HEADER /start
"use strict";
$().ready(function() {
    var debug = false;
    var is_open = false;
    var menu_item = $(".menu-block-header .menu-items .menu-item");
    menu_item.on("click, mouseover", function() {
        var has_sub = $(this).has(".menu-level-2").length;
        if(!is_open && has_sub) {
            var menu_level_2 = $(this).find(".menu-level-2");
            is_open = true;
            menu_item.removeClass("open");
            $(this).addClass("open");
            var win_w = window.innerWidth;
            var b = $(this).width();
            var w = menu_level_2.width();
            // Адаптив
            if(1170 > win_w && win_w >= 1024) {
                menu_level_2.css({"left": ( (b - w) / 2) + "px"});
            }
            // Выход за страницу
            var offset = menu_level_2.offset();
            var R = offset.left + w;
            var D = + $(".menu-block-header .menu-items").width() + $(".menu-block-header .menu-items").offset().left;

            if( !menu_level_2.attr('optimal') ) {
                if (R > D) {
                    var m_w = $(".menu-block-header .menu-items").width();
                    var P = (win_w - m_w) / 2;
                    var F = R - P;
                    var now_left = $(this).css('left').replace(/[^-\d\.]/g, '');
                    var left = now_left - (F - m_w);
                    menu_level_2.css({"left": left + "px"});
                    menu_level_2.attr({'optimal':true});
                }
            }
            var has = menu_level_2.has(".back").length;
            if (!has ) {
                var name = $(this).find("> a .menu-item-name").html();
                menu_level_2.prepend('<div class="back"><span class="korsar-icon arrow-back"></span><span class="name">' + name + '</span></div>');
            }
        }
   });
    menu_item.on("click, mouseout", function(e) {
        e.stopPropagation();
        if(is_open) {
            is_open = false;
            menu_item.removeClass("open");
        }
    });
    menu_item.on("click", ".back .arrow-back", function(e) {
        e.stopPropagation();
        $(this).closest(".open").removeClass("open");
        is_open = false;
    });
});

// INCLUDE HEADER /close
// Include on ORDER PAGE !!!  /open
"use strict";
$().ready(function() {

    // Filter check
    $(".delivery-option").click(function () {
        $(this).parent().find(".current").removeClass("current");
        $(this).addClass("current");
        switch_delivery();
    });
    // First check
    $(".delivery-option").find("input:checked").parent().addClass("current");


    function switch_delivery() {
        var chs =  $(".delivery-option").find("input:checked").val();
        $(".del-russia").css({"display":"none"});
        $(".del-moscow").css({"display":"none"});
        $(".del-none-display").css({"display":"none"});
        $(".del-none").css({"display":"block"});

        switch (chs) {
            case "del-russia" :
                $(".del-russia").css({"display":"block"});
                break;
            case "del-moscow" :
                $(".del-moscow").css({"display":"block"});
                break;
            case "del-none" :
                $(".del-none").css({"display":"none"});
                $(".del-none-display").css({"display":"block"});
                break;
        }
    }
    switch_delivery();

    // Filter check
    $(".pay-system .item").click(function() {
        $(this).parent().find(".current").removeClass("current");
        $(this).addClass("current");
    });
    // First check
    $(".pay-system").find("input:checked").parent().addClass("current");


    $(".save-lk").click(function(){
        // TODO ajax save data here
        var ajax = true;
        if(ajax) {
            $(".step-2").css({"display":"block"});
        }
    });
});
// Include on ORDER PAGE !!!  /close
// INCLUDE personal area page /start
"use strict";
$().ready(function() {
    function fragment(fragmentClass) {
        $(".fragments .active").removeClass("active");
        $("."+fragmentClass).addClass("active");
    }
    $(".personal-navigation .item-navigation").click(function() {
        var fragmentClass = $(this).attr("data");
        $(".personal-navigation .item-navigation").removeClass("active");
        $(this).addClass("active");
        fragment(fragmentClass);
    });
    $(".tax-system .item").click(function(){
        $(".tax-system .item").removeClass("current");
        $(this).addClass("current");
    });
    $(".open_tab").click(function() {
       $(".note-tab-content").removeClass("active");
       var c = $(this).closest(".note").find(".note-tab-content");
       c.addClass("active");
    });
});
// INCLUDE personal area page /close
// INCLUDE where good video /start
$().ready(function() {
    $(".play_video").click(function() {
        // Close old
        $.each($(".video_view"), function(key, v){
            if( $(v).html() ) {
                var good_image_block = $(v).closest(".good_image_block").length ? $(v).closest(".good_image_block") : $(v).closest(".good_image");
                console.log("Old play...");
                var image = good_image_block.find("img");
                $(v).css({ "display":"none" });
                image.css({
                    "opacity":"1"
                });
                $(v).html("")
            }
        });
        var good_image_block = $(this).closest(".good_image_block").length ? $(this).closest(".good_image_block") : $(this).closest(".good_image");
        var video = good_image_block.find(".video_view");
        var image = good_image_block.find("img");
        image.css({
            "opacity":"0"
        });
        video.css({
            "display":"block",
            "width":good_image_block.width()+"px",
            "height":good_image_block.height()+"px"
        });
        // TODO AJAX LOAD VIDEO HERE or other method...
        video.html( '<div class="close korsar-icon"></div>' +
                    '<video autoplay="autoplay" width="'+good_image_block.width()+'" height="'+good_image_block.height()+'" controls="controls" poster="'+image.attr("data-src")+'">'+
                        '<source src="video/videoplayback.mp4">'+ // Add more source...
                        '<source src="video/videoplayback.webm">'+ // Add more source...
                        'Тег video не поддерживается вашим браузером.'+
                        '<a href="video/videoplayback.mp4">Скачайте видео</a>.'+
                    '</video>');

        video.find(".close").click(function() {
            video.css({ "display":"none" });
            image.css({
                "opacity":"1"
            });
            video.html(" ");
        });
    });
});
// INCLUDE where good video /close
// Include on HEADER !!!  /open
"use strict";
$().ready(function() {
    // Filter check
    $(".filter-items .item").click(function() {
        $(this).parent().find(".current").removeClass("current");
        $(this).addClass("current");
    });
    // First check
    $(".filter-items").find("input:checked").parent().addClass("current");
    // Block control viewports filters and menu on mobile
    var is_open = false;
    var is_open_filter = false;
    // Filter open close function
    $(".menu-btn-mobile-filters").click(function() {
        var elem = $(".aside-filters");
        if(is_open) {
            elem.addClass("korsar-hide");
            is_open_filter = false;
        } else {
            elem.removeClass("korsar-hide");
            is_open_filter = true;
        }
        content_display();
    });
    // Menu open close function
    $(".menu-block-header .menu-btn-mobile, .menu-block-header .menu-close").click(function() {
        var elem = $(".menu-block-header .menu-items");
        if(is_open_filter) {
            is_open = !is_open;
            $(".aside-filters").addClass("korsar-hide");
            is_open_filter = false;
        }
        if(is_open) {
            elem.addClass("korsar-hide");
        } else {
            elem.removeClass("korsar-hide");
        }
        content_display();
    });
    function content_display() {
        var d = is_open ? "block" : "none";
        $(".content_closer").css({"display": d});
        $("footer").css({"display": d});
        is_open = !is_open;
    }

    var cart = {}; // Some model data of cart...
    // Add item count control

    // Update mini cart
    // TODO update... Ajax... and more....
    function updateMiniCart() {
        if(!cart.items ) {
            cart.items = [];
        }
    }

    // CATALOG IMAGE
    $(".good_image img").each(function(k, img) {
        var img = $(img).closest(".good_image");
        var w = img.width();
        var h = w * 0.6; // 5:3
        img.height(h);
    });
});

// Include on HEADER !!! /close
// INCLUDE where silder set or anyway / start
"use strict";
$().ready(function() {
    var debug = false;
    var slider = $(".swipe_slider");
    var attr = slider.attr('data-slider');
    var data_slider = {};
    if(attr) {
        data_slider = jQuery.parseJSON(attr);
    }
    var sw_lr_padding = data_slider.sw_lr_padding ? data_slider.sw_lr_padding : 20;
    slider.css({"padding-left":sw_lr_padding, "padding-right":sw_lr_padding});
    var dots_control = data_slider.dots_control ? data_slider.dots_control : false;
    var swipe_error = data_slider.swipe_error ? data_slider.swipe_error : 50;
    var arrow_control = data_slider.arrow_control ? data_slider.arrow_control : 0;
    var l_padding = data_slider.l_padding ? data_slider.l_padding : 0;
    var slides_dispayd = data_slider.slides_dispayd ? data_slider.slides_dispayd : 1;
    var count_slide = slider.find('.slide').length ;
    var window_width = $(document).width();
    var w = (slider.find(".slides-wrap").width() / slides_dispayd - l_padding); // Slider width
    var multiplicity_slides =  data_slider.multiplicity_slides ? data_slider.multiplicity_slides : {
        320 : 1,
        375 :2,
        1024 : 3,
        1170 : 4
    }
    var max_slide_height  = data_slider.max_slide_height ? data_slider.max_slide_height : 100;
    var slides_margin = 0;
    var max_slides_margin = count_slide * w;
    var slide_view = 0;

    function adaptive_slider() {
        $.each(multiplicity_slides, function (key, value) {
            if (window_width >= key) {
                slides_dispayd = value;
            }
        });
        w = (slider.find(".slides-wrap").width() / slides_dispayd - l_padding);
        max_slides_margin = count_slide * w;

        if(!arrow_control){
            slider.find(".previous ").hide().addClass("forever_disabled");
            slider.find(".next ").hide().addClass("forever_disabled");
        }

        if(dots_control) {
            slider.append("<div class='dots'></div>");
            var areas = slideSAreaCount();
            for(var i = 0; areas > i; i++) {
                slider.find(".dots").append("<div class='dot' data-goto='"+(i+1)+"'></div>");
            }
            // centred
            slider.find(".dots").css({"left":(( slider.find(".slides-wrap").width() - slider.find(".dots").width()) / 2)+"px"});
        }
    }
    adaptive_slider();

    function resize_slides(width) {
        var slide_step = 0;
        slider.find('.slide').each(function(key, slide) {
            $(slide).width(width);
            $(slide).css({'left':(slide_step * width)+"px"});
            max_slide_height = (max_slide_height < $(slide).height()) ? $(slide).height() : max_slide_height;
            slide_step++;
        });

        slider.find('.slides').css({'height':max_slide_height+"px"});
        var ph = slider.find(".previous").height();
        var control_h  = max_slide_height / 2 - (ph / 2);
        slider.find(".previous").css({"top":control_h + "px"});
        slider.find(".next").css({"top":control_h + "px"});
    }
    // Init call
    resize_slides(w);

    slider.find("img").bind("load", function(){
        resize_slides(w);
    });

    // Control event
    slider.find(".previous").click(function(){
        if(!$(this).hasClass('disabled'))
            moveSlide(slides_dispayd);
    });
    slider.find(".next").click(function(){
        if(!$(this).hasClass('disabled'))
            moveSlide(slides_dispayd*-1);
    });
    // Control swipe
    var start_x;
    var stop_x;
    var allowed_touch_derection = {'next':true, 'previous':true};
    slider.find('.slide').bind('touchstart', function(e){
        start_x = e.originalEvent.touches[0].pageX;
    });
    slider.find('.slide').bind('touchend', function(e) {
        stop_x = e.originalEvent.changedTouches[0].clientX;
        if(debug) {
            console.log({
                start_x:start_x,
                stop_x:stop_x
            })
        };
        if(start_x !== stop_x) {
            if (start_x - swipe_error < stop_x + swipe_error) {
                if (allowed_touch_derection.previous) {
                    moveSlide(slides_dispayd)
                };
            } else {
                if (allowed_touch_derection.next) {
                    moveSlide(slides_dispayd * -1)
                };
            }
        }
    });
    slider.find('.dots .dot').bind('click', function(e) {
        var vector = 0;
        var goto_num = parseInt($(this).attr('data-goto'));
        vector = ( (slide_view + goto_num) - 1 )* -1;
        moveSlide(vector);
    });
    function moveSlide(slide_derection) {
        // slides_dispayd
        slide_view += slide_derection;
        var slide_margin_pre = slide_view * w;
        // Detect max margin
        if((max_slides_margin*-1) >= (slide_margin_pre - w * slides_dispayd)) {
            slider.find(".next").addClass('disabled').hide();
            allowed_touch_derection.next = false;
        } else {
            slider.find(".next").removeClass('disabled').show();
            allowed_touch_derection.next = true;
        }
        // Detect min margin
        if(0 === slide_margin_pre) {
             slider.find(".previous").addClass('disabled').hide();
            allowed_touch_derection.previous = false;
        } else {
           slider.find(".previous").removeClass('disabled').show();
            allowed_touch_derection.previous = true;
        }
        slides_margin = slide_margin_pre;
        slider.find('.slides').css({'margin-left':slides_margin+"px"});
        var s = (slide_view*-1)+1;
        slider.find('.dots .dot').removeClass("current");
        slider.find('.dots .dot:nth-child('+s+')').addClass("current");
        if(debug) {
            console.log({
                slide_derection:slide_derection,
                slide_view:slide_view,
                allowed_touch_derection:allowed_touch_derection,
                max_slides_margin:max_slides_margin,
                slide_margin_pre:slide_margin_pre,
                slides_margin:slides_margin,
                slides_dispayd:slides_dispayd,
                w:w,
                s:s
            })
        };
    }
    // Single shot
    moveSlide(0);
    // рассчитывем количество слайдов
    function slideSAreaCount() {
        var count = 0;
        count = Math.ceil(count_slide / slides_dispayd);
        return count;
    }
});
// INCLUDE where silder set or anyway /close
// include anyway !!!!!! \start

//Auto Currying (автоматическое каррирование)
function declOfNum(n, titles) {
    return titles[(n % 10 === 1 && n % 100 !== 11) ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2];
}

// include anyway !!!!!! \close
// Include any way ! /start
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.inView=e():t.inView=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(2),o=r(i);t.exports=o["default"]},function(t,e){function n(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(9),o=r(i),u=n(3),f=r(u),s=n(4),c=function(){if("undefined"!=typeof window){var t=100,e=["scroll","resize","load"],n={history:[]},r={offset:{},threshold:0,test:s.inViewport},i=(0,o["default"])(function(){n.history.forEach(function(t){n[t].check()})},t);e.forEach(function(t){return addEventListener(t,i)}),window.MutationObserver&&addEventListener("DOMContentLoaded",function(){new MutationObserver(i).observe(document.body,{attributes:!0,childList:!0,subtree:!0})});var u=function(t){if("string"==typeof t){var e=[].slice.call(document.querySelectorAll(t));return n.history.indexOf(t)>-1?n[t].elements=e:(n[t]=(0,f["default"])(e,r),n.history.push(t)),n[t]}};return u.offset=function(t){if(void 0===t)return r.offset;var e=function(t){return"number"==typeof t};return["top","right","bottom","left"].forEach(e(t)?function(e){return r.offset[e]=t}:function(n){return e(t[n])?r.offset[n]=t[n]:null}),r.offset},u.threshold=function(t){return"number"==typeof t&&t>=0&&t<=1?r.threshold=t:r.threshold},u.test=function(t){return"function"==typeof t?r.test=t:r.test},u.is=function(t){return r.test(t,r)},u.offset(0),u}};e["default"]=c()},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,r){n(this,t),this.options=r,this.elements=e,this.current=[],this.handlers={enter:[],exit:[]},this.singles={enter:[],exit:[]}}return r(t,[{key:"check",value:function(){var t=this;return this.elements.forEach(function(e){var n=t.options.test(e,t.options),r=t.current.indexOf(e),i=r>-1,o=n&&!i,u=!n&&i;o&&(t.current.push(e),t.emit("enter",e)),u&&(t.current.splice(r,1),t.emit("exit",e))}),this}},{key:"on",value:function(t,e){return this.handlers[t].push(e),this}},{key:"once",value:function(t,e){return this.singles[t].unshift(e),this}},{key:"emit",value:function(t,e){for(;this.singles[t].length;)this.singles[t].pop()(e);for(var n=this.handlers[t].length;--n>-1;)this.handlers[t][n](e);return this}}]),t}();e["default"]=function(t,e){return new i(t,e)}},function(t,e){"use strict";function n(t,e){var n=t.getBoundingClientRect(),r=n.top,i=n.right,o=n.bottom,u=n.left,f=n.width,s=n.height,c={t:o,r:window.innerWidth-u,b:window.innerHeight-r,l:i},a={x:e.threshold*f,y:e.threshold*s};return c.t>e.offset.top+a.y&&c.r>e.offset.right+a.x&&c.b>e.offset.bottom+a.y&&c.l>e.offset.left+a.x}Object.defineProperty(e,"__esModule",{value:!0}),e.inViewport=n},function(t,e){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(e,function(){return this}())},function(t,e,n){var r=n(5),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},function(t,e,n){function r(t,e,n){function r(e){var n=x,r=m;return x=m=void 0,E=e,w=t.apply(r,n)}function a(t){return E=t,j=setTimeout(h,e),M?r(t):w}function l(t){var n=t-O,r=t-E,i=e-n;return _?c(i,g-r):i}function d(t){var n=t-O,r=t-E;return void 0===O||n>=e||n<0||_&&r>=g}function h(){var t=o();return d(t)?p(t):void(j=setTimeout(h,l(t)))}function p(t){return j=void 0,T&&x?r(t):(x=m=void 0,w)}function v(){void 0!==j&&clearTimeout(j),E=0,x=O=m=j=void 0}function y(){return void 0===j?w:p(o())}function b(){var t=o(),n=d(t);if(x=arguments,m=this,O=t,n){if(void 0===j)return a(O);if(_)return j=setTimeout(h,e),r(O)}return void 0===j&&(j=setTimeout(h,e)),w}var x,m,g,w,j,O,E=0,M=!1,_=!1,T=!0;if("function"!=typeof t)throw new TypeError(f);return e=u(e)||0,i(n)&&(M=!!n.leading,_="maxWait"in n,g=_?s(u(n.maxWait)||0,e):g,T="trailing"in n?!!n.trailing:T),b.cancel=v,b.flush=y,b}var i=n(1),o=n(8),u=n(10),f="Expected a function",s=Math.max,c=Math.min;t.exports=r},function(t,e,n){var r=n(6),i=function(){return r.Date.now()};t.exports=i},function(t,e,n){function r(t,e,n){var r=!0,f=!0;if("function"!=typeof t)throw new TypeError(u);return o(n)&&(r="leading"in n?!!n.leading:r,f="trailing"in n?!!n.trailing:f),i(t,e,{leading:r,maxWait:e,trailing:f})}var i=n(7),o=n(1),u="Expected a function";t.exports=r},function(t,e){function n(t){return t}t.exports=n}])});
"use strict";


// Image auto resolution detect
inView('img.width-load-control').on('enter', function (element) {
    if(!$(element).attr('data-image-set')) {
        var window_width = $(document).width();
        var default_res = 's';
        // Object to set resolution
        var resolution_set = {
            'xs': 0,
            's': 375,
            'm': 480,
            'l': 1024
        };
        var images = jQuery.parseJSON($(element).attr('data-loader'));
        default_res = choseRes(resolution_set, images);
        var special_res;
        if (images.resolution) {
            special_res = choseRes(images.resolution, images);
        }
        var r = special_res ? special_res : default_res;
        if(r) {
            $(element).attr({'src': images[r]});
        } else{
            $(element).attr({'src': $(element).attr("data-src")});
        }
        function choseRes(ar, img) {
            var r;
            $.each(ar, function (key, value) {
                if (window_width >= value && img[key]) {
                    r = key;
                }
            });
            return r;
        }
    }
});

$().ready(function() {
    $('.background_lizy_load').css({
        "opacity": 0,
        "transition": "all 0.4s"
    });
    inView('.background_lizy_load').on('enter', function (element) {
        $(element).css({
            "background-image": "url("+$(element).attr('data-src')+")",
            "opacity":1
        });
    });

    $('img.lizy_load').css({
        "opacity": 0,
        "transition": "all 0.4s"
    });
    inView('img.lizy_load').on('enter', function (element) {
        $(element).attr({
            "src": $(element).attr('data-src')
        }).css({"opacity":1});
    });
});
// Include any way ! /stop
"use strict";
// Утилиты и типографические улучшайзеры
$().ready(function() {
    var truncate = function(description, width, rows){
        var l = 50;
        var char_w = 12;
        var max_chars = (width * rows) / char_w;
        console.log(max_chars);
        if(description.split('').length > max_chars) {
            return description.split('').slice(0, description.lastIndexOf(" ", max_chars)).join('') + "...";
        }
        return description;
    }

    $(".truncate-text").each(function(key, element) {
        var width =  $(element).width();
        var t =  truncate( $(element).text(), width, 2 );
        $(element).html(t);
    });
});
